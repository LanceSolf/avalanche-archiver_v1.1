<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Latest Snow Profiles</title>
    <link rel="stylesheet" href="../../styles.css">
    <style>
        .profile-list { display: grid; gap: 2rem; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); margin-top:2rem; }
        .station-card { background: white; padding: 1.5rem; border-radius: 12px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); border: 1px solid #e5e7eb; }
        .station-header { border-bottom: 2px solid #3b82f6; margin-bottom: 1rem; padding-bottom: 0.5rem; display:flex; justify-content:space-between; align-items:center; }
        .station-name { font-size: 1.1rem; margin:0; color: #1e40af; font-weight:700; }
        .latest-update { font-size: 0.85rem; color: #6b7280; }
        .data-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 0.5rem; margin-bottom: 1rem; }
        .data-item { display:flex; flex-direction:column; }
        .data-label { font-size: 0.75rem; text-transform:uppercase; color: #6b7280; font-weight:600; }
        .data-value { font-weight: 600; font-size: 0.95rem; }
        .source-link { color: #ef4444; font-weight: bold; text-decoration: none; font-size:0.9rem;}
        .source-link:hover { text-decoration: underline; }
        .map-container { width: 100%; height: 500px; border-radius: 12px; overflow: hidden; border: 1px solid #e5e7eb; box-shadow: 0 1px 3px rgba(0,0,0,0.1); margin-bottom: 1rem; }
        .stability-tag { display: inline-block; background: #fee2e2; color: #991b1b; padding: 2px 6px; border-radius: 4px; font-size: 0.8rem; font-weight: 600; margin-right: 4px; margin-bottom: 4px; border:1px solid #fca5a5; }
    </style>
</head>
<body>
    <div class="container">
        <header><div class="header-content"><a href="../../index.html" class="logo">Avalanche Archive</a><div class="date-nav"><span>Snow Profiles</span></div></div></header>
        
        <h1>Latest Snow Profiles (Last 21 Days)</h1>

        <!-- Requested Back Link -->
        <div style="margin-bottom: 1rem;"><a href="../../index.html">&larr; Back</a></div>

        <div class="map-container">
             <iframe src="map.html" width="100%" height="100%" style="border:none;"></iframe>
        </div>

        <div style="margin-top: 1rem; margin-bottom: 0rem;"><a href="../../index.html">&larr; Back</a></div>

        <div class="profile-list">
            
            <div class="station-card">
                <div class="station-header">
                    <h2 class="station-name"><a href="24410.html" style="color:inherit; text-decoration:none;">Riezlern</a></h2>
                    <span class="latest-update">2026-01-12 10:45:00</span>
                </div>
                <div class="data-grid">
                   <div class="data-item"><span class="data-label">Elev</span><span class="data-value">1800 m</span></div>
                   <div class="data-item"><span class="data-label">Aspect</span><span class="data-value">N</span></div>
                   <div class="data-item"><span class="data-label">Slope</span><span class="data-value">35Â°</span></div>
                   <div class="data-item"><span class="data-label">HS</span><span class="data-value">-</span></div>
                </div>
                
                
                <a href="24410.html" class="source-link">View Detail &rarr;</a>
                
                

            </div>
            
            <div class="station-card" style="border: 2px dashed #bae6fd; background: #f0f9ff; display:flex; flex-direction:column; justify-content:center; align-items:center; text-align:center;">
                 <a href="../../profile-creator/index.html" class="source-link" style="color:#1e40af; font-size:1.1rem; margin-bottom:1rem;">Upload your own profile &rarr;</a>
                 <div style="height: 1px; width: 100%; background: #e5e7eb; margin-bottom: 1rem;"></div>
                 <p style="color:#666; margin-bottom:1rem;">View full database on Lawis.at</p>
                 <a href="https://lawis.at/profile/" target="_blank" class="source-link" style="font-size:1.1rem;">Go to Lawis &rarr;</a>
            </div>
        </div>
        
        <div style="margin-top:2rem"><a href="../../index.html">&larr; Back</a></div>
    </div>

    <!-- Delete Modal -->
    <div id="deleteModal" class="modal-overlay" style="display: none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); align-items:center; justify-content:center;">
        <div class="modal" style="background:white; padding:2rem; border-radius:12px; max-width:400px; width:90%; text-align:center;">
            <h3 style="margin-top:0; color:#ef4444;">Remove Report?</h3>
            <p>Are you sure you want to remove this report?</p>
            <div style="margin: 1rem 0; text-align:left;">
                <label style="display:flex; align-items:center; gap:0.5rem; cursor:pointer;">
                    <input type="checkbox" id="confirmAuth" onchange="toggleDeleteBtn()">
                    <span style="font-size:0.9rem;">I confirm I am the author of this report or have authority to remove it.</span>
                </label>
            </div>
            <div class="modal-actions" style="display:flex; gap:1rem; justify-content:center; margin-top:1.5rem;">
                <button onclick="closeModal()" style="background:#e5e7eb; border:none; padding:0.5rem 1rem; border-radius:6px; cursor:pointer;">Cancel</button>
                <button id="btnDelete" onclick="confirmDelete()" style="background:#ef4444; color:white; border:none; padding:0.5rem 1rem; border-radius:6px; cursor:pointer; opacity: 0.5; pointer-events: none;">Remove</button>
            </div>
        </div>
    </div>

    <script>
        let deleteId = null;
        
        function requestDelete(id) {
            deleteId = id;
            document.getElementById('deleteModal').style.display = 'flex';
            document.getElementById('confirmAuth').checked = false;
            toggleDeleteBtn();
        }

        function closeModal() {
            document.getElementById('deleteModal').style.display = 'none';
            deleteId = null;
        }

        function toggleDeleteBtn() {
            const btn = document.getElementById('btnDelete');
            if(document.getElementById('confirmAuth').checked) {
                btn.style.opacity = '1';
                btn.style.pointerEvents = 'auto';
            } else {
                btn.style.opacity = '0.5';
                btn.style.pointerEvents = 'none';
            }
        }

        async function confirmDelete() {
            if(!deleteId) return;
            const btn = document.getElementById('btnDelete');
            btn.innerText = 'Deleting...';
            
            try {
                // Determine ID (strip user- prefix if purely a backend ID, but we used full ID in KV)
                // Actually our KV keys are likely just the timestamp or the ID we generated. 
                // Wait, in buildProfilePages.js we force an ID: "user-${new Date(u.date).getTime()}-${i}"
                // But the backend ID is "id" field in u.id. THIS IS IMPORTANT.
                // We need to use values.u.id NOT the generated p.profil_id if they differ.
                // In buildProfilePages we set profil_id = "user-..." BUT u has u.id from worker.
                // We need to pass the REAL backend ID to the delete function.
                
                // Let's assume for now we need to fix the ID passing in the loop above first?
                // Actually, let's fix the loop to use p.original_id if available or we might have an issue.
                // See below note.
                
                await fetch('https://avalanche-archiver-uploads.bigdoggybollock.workers.dev/delete', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ id: deleteId })
                });
                
                // Reload to reflect changes (removed locally by rebuild script usually, but for now just reload)
                alert('Item removed. It will disappear from the site on the next build (approx 4 hours) or sooner.');
                closeModal();
                btn.innerText = 'Remove';
            } catch(e) {
                alert('Error deleting: ' + e.message);
                btn.innerText = 'Remove';
            }
        }
    </script>
</body>
</html>